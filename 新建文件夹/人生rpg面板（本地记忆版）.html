<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>åƒå¯»çš„äººç”ŸRPG</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#4a6cf7" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f6fa;
      margin: 0;
      padding: 24px;
    }
    h1 { margin-bottom: 8px; }
    .subtitle { font-size: 12px; color: #666; margin-bottom: 16px; }
    .panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .card h2 {
      margin-top: 0;
      font-size: 18px;
    }
    .exp { font-size: 14px; margin: 6px 0; }
    .small { font-size: 12px; color: #777; }
    button {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      background: #4a6cf7;
      color: white;
      cursor: pointer;
      margin-top: 6px;
    }
    button.secondary { background: #555; }
    .footer { margin-top: 24px; font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <h1>äººç”Ÿ RPG é¢æ¿</h1>
  <div class="subtitle">ä½åé¦ˆç°å®ä¸–ç•Œ Â· äººå·¥ç»“ç®—ç³»ç»Ÿ</div>

  <div class="panel" id="panel"></div>

  <button class="secondary" onclick="sleepSettlement()">ğŸ›ï¸ ç¡è§‰ç»“ç®—ï¼ˆä»Šå¤©ç»“æŸï¼‰</button>

  <div class="footer">
    è¯´æ˜ï¼šEXP ä¸ºç´¯è®¡å€¼ï¼›â€œæ˜¨å¤© EXPâ€æ¥è‡ªä¸Šä¸€æ¬¡ç¡è§‰ç»“ç®—ã€‚æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ã€‚
  </div>

<script>
const ATTRS = {
  INT: 'è¯­è¨€',
  VIT: 'ä½“èƒ½',
  RES: 'ç§‘ç ”',
  SAN: 'ç²¾ç¥'
};

function todayKey() {
  return new Date().toISOString().slice(0,10);
}

function loadState() {
  return JSON.parse(localStorage.getItem('RPG_STATE') || '{}');
}

function saveState(state) {
  localStorage.setItem('RPG_STATE', JSON.stringify(state));
}

function init() {
  const state = loadState();
  const panel = document.getElementById('panel');
  panel.innerHTML = '';

  Object.keys(ATTRS).forEach(key => {
    const total = state.total?.[key] || 0;
    const last = state.lastTime?.[key] || 'â€”';
    const yest = state.yesterday?.[key] || 0;

    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <h2>${key}ï½œ${ATTRS[key]}</h2>
      <div class="exp">EXPï¼š<span id="total-${key}">${total}</span></div>
      <div class="small">æ˜¨å¤© EXPï¼š<span id="yest-${key}">${yest}</span></div>
      <div class="small">ä¸Šä¸€æ¬¡å®Œæˆï¼š<span id="last-${key}">${last}</span></div>
      <button onclick="addExp('${key}')">å®Œæˆä¸€æ¬¡</button>
    `;
    panel.appendChild(div);
  });
}

function addExp(key) {
  const state = loadState();
  const today = todayKey();

  state.total = state.total || {};
  state.today = state.today || {};
  state.lastTime = state.lastTime || {};

  state.total[key] = (state.total[key] || 0) + 1;
  state.today[key] = (state.today[key] || 0) + 1;
  state.lastTime[key] = new Date().toLocaleString();

  saveState(state);
  init();
}

function sleepSettlement() {
  const state = loadState();
  state.yesterday = state.today || {};
  state.today = {};
  saveState(state);
  init();
  alert('ä»Šå¤©å·²ç»“ç®—ï¼Œå¯ä»¥å®‰å¿ƒä¸‹çº¿äº†ã€‚');
}

init();

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}

</script>
</body>
</html>
